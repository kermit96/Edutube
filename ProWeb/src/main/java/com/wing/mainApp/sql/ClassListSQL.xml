<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="clist">
	<!-- 총 데이터 수 구하기 -->
	<select id="gettotal" resultType="java.lang.Integer">
		SELECT
			COUNT(*) AS TOTAL
		FROM
			class
	</select>
	<!--  과목별 총 데이터 수 구하기 -->
	<select id="gettotalofsub" resultType="int" parameterType="String">
		Select
			Count(*) as Total
		From
			Class
		where
			sub_code=#{code}		
	</select>
	
	
	<!-- 게시물 등록 (동영상 없는 경우)-->
	<insert id="classinsert" parameterType="ClassListData">
		INSERT
		INTO
			class (class_no,sub_code,mem_id,mem_nick,	class_title,class_body)
		VALUES
			((SELECT NVL(MAX(no), 0) + 1 FROM class),${code},${id},${nick},#{title},#{body})
	</insert>
	<!-- 목록보기 (전체용)-->
	<select id="getlist" resultType="ClassListData">
        SELECT
            class_no    AS no,
            s.sub_name AS code,
            class_title    AS title,
            mem_nick        AS nick,
            class_date    AS wdate,
            class_good AS good,
            class_hit as hit            
        FROM
            class c,subject s
        where
            C.SUB_CODE = S.SUB_CODE  
        ORDER BY
            no DESC
	</select>
	<!-- 목록보기 (과목별)-->
	<select id="getlistofsub" resultType="ClassListData" parameterType="String">
		        SELECT
            class_no    AS no,
            s.sub_name AS code,
            class_title    AS title,
            mem_nick   AS nick,
            class_date    AS wdate,
            class_good AS good,
            class_hit		AS  hit            
        FROM
            class c,subject s
        where
            C.SUB_CODE = S.SUB_CODE 
        and
            C.SUB_CODE = #{code}  
        ORDER BY
            no DESC			
	</select>
	

	
	<!-- 상세보기 -->
	<select id="classview" resultType="ClassListData" parameterType="java.lang.Integer">
		SELECT
			no AS no,
			title	AS title,
			body	AS body
		FROM
			class
		WHERE
			no = #{NO}
	</select>
	<!-- 수정 삭제 -->
	<select id="isupdate" resultType="java.lang.Integer" parameterType="Hmap">
		SELECT
			COUNT(*) AS CNT
		FROM
			class
		WHERE
			no = #{NO}
	</select>
	<!-- 수정 질의 -->
	<update id="updateclass" parameterType="ClassListData">
		UPDATE
			class
		SET
			title = #{title},
			body = #{body},
			date = SYSDATE
		WHERE
			no = #{NO}
	</update>
	<!-- 삭제 질의 -->
	<update id="deleteclass"	parameterType="java.lang.Integer">
		UPDATE
			class
		SET
			isDeleted = 'N'
		WHERE
			no = #{NO}
	</update>

</mapper>