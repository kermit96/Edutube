<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cboard">
<!-- FAQ 등록 질의(관리자) -->
	<insert id="faqinsert" parameterType="cbdata">
		INSERT
		INTO
			FAQ (FAQ_NO, QT_NO, mem_ID, FAQ_TITLE, FAQ_BODY)
		VALUES
			((SELECT NVL(MAX(FAQ_no),0) + 1 FROM FAQ),
			(SELECT QT_no FROM QType WHERE QT_no = #{qno}),
			#{id},#{title},#{body})
	</insert>
<!-- FAQ총 데이터 갯수 구하기 질의 -->
	<select id="gettotal" resultType="java.lang.Integer">
		SELECT
			COUNT(*)	AS		TOTAL
		FROM
			FAQ
		WHERE
			FAQ_isDeleted = 'N'
	</select>
<!-- FAQ 목록 보기 질의 -->
	<select id="faqselect"  resultType="cbdata">
		SELECT
			FAQ_title 	AS TITLE,
			FAQ_body 	AS BODY
		FROM
			FAQ
		WHERE
			FAQ_isDeleted= 'N'
	</select>
<!--  QA_no 알아내는 질의 -->
	<select id="nosearch" resultType="java.lang.Integer" parameterType="java.lang.Integer">
		SELECT
			NVL(MAX(QA_no), 0) +1	AS		NO
		FROM
			QA
	</select>
<!-- QA게시물 등록질의(사용자)  -->
	<insert id="qainsert" parameterType="cbdata">
		INSERT
		INTO
			QA<!--  (QA_no, mem_id, QT_no, QA_title, QA_body, QA_date, QA_isAnswer, QA_cDate, QA_isDeleted, QA_top, QA_mid, QA_bottom) -->
		VALUES
			((SELECT NVL(MAX(QA_no), 0) + 1 FROM QA),#{id},#{qno},#{title},#{body},SYSDATE,'N',SYSDATE,'N', #{top},#{mid},#{bottom})
	</insert>
<!-- QA총 데이터 갯수 구하기 질의 -->
	<select id="gettotals" resultType="java.lang.Integer">
		SELECT
			COUNT(*)	AS		TOTAL
		FROM
			QA
		WHERE
			QA_isDeleted = 'N'
	</select>
<!--  QA게시물 목록가져오기 질의 -->
	<select id="qaselect" resultType="cbdata">
		SELECT
			QA_no		AS		NO,
   			mem_id		AS		ID,
   			QT_no		AS		QNO,
   			QA_title		AS		TITLE,
   			QA_body	AS		BODY,
   			QA_date		AS		WDATE,
   			QA_top		AS		TOP,
   			QA_mid		AS		MID,
   			QA_Bottom	AS		BOTTOM
		FROM
			QA
		WHERE
			QA_isDeleted = 'N'
		ORDER BY
			QA_top DESC, QA_bottom ASC
	</select>
<!--  QA상세보기 질의 -->
	<select id="qaview" resultType="cbdata" parameterType="java.lang.Integer">
		SELECT
			QA_no		AS 	NO,
   			mem_id		AS 	ID, 
   			QA_title		AS 	TITLE,
   			QA_body	AS 	BODY,
   			QA_date 	AS 	WDATE,
   			QA_top		AS		TOP,
   			QA_mid		AS		MID,
   			QA_Bottom	AS		BOTTOM
		FROM
			QA
		WHERE
			QA_no = #{NO}
	</select>
<!--  QA답글 달기 질의 -->
	<update id="qareple" parameterType="cbdata">
		UPDATE
			QA
		SET
			QA_bottom = QA_bottom + 1
		WHERE
				QA_top = #{no}
		AND	QA_bottom >= #{bottom}
	</update>
<!-- QA 검색데이터 갯수 구하기 질의 -->
	<select id="searchcount" resultType="java.lang.Integer" parameterType="java.util.HashMap">
		SELECT
			COUNT(*)		AS CNT
		FROM
			QA
		WHERE
			<if test="kind == 'title'">
				QA_title LIKE '%' || #{CONTENT} || '%'
			</if>
			<if test="kind == 'writer'">
				mem_id LIKE '%' || #{CONTENT} || '%'
			</if>
			<if test="kind == 'both'">
				QA_title LIKE '%' || #{CONTENT} || '%' OR mem_id LIKE '%' || #{CONTENT} || '%'
			</if>
	</select>
<!-- QA검색 질의 -->
	<select id="searchboard" resultType="cbdata" parameterType="java.util.HashMap">
		SELECT
			QA_no		AS		NO,
   			mem_id		AS		ID,
   			QT_no		AS		QNO,
   			QA_title		AS		TITLE,
   			QA_body	AS		BODY,
   			QA_date		AS		WDATE
		FROM
			QA
		WHERE
					QA_isDeleted = 'N'
			<choose>
				<when test="kind eq 'title'">
					AND	QA_title LIKE '%' || #{CONTENT} || '%'
				</when>  
				<when test="kind eq 'writer'">
					AND	mem_id LIKE '%' || #{CONTENT} || '%'
				</when> 
				<otherwise>
					AND	(QA_title LIKE '%' || #{CONTENT} || '%' OR mem_id LIKE '%' || #{CONTENT} || '%')
				</otherwise>
			</choose>
		ORDER BY
			QA_NO DESC
	</select>
</mapper>